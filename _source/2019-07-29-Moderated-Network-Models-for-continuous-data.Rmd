---
layout: post
title: "Moderated Network Models for Continuous Data'"
date: 2017-02-16 11:00:00 +0100
categories: r
comments: true
status: development
# published: true
# status: development
# published: false
---


One paragraph motivation and what the blogpost will be about


## Moderated Network Models

Quick explainer what this is about.


## The XX Data set

Read the data:

```{r, message=FALSE}
load("/Users/jonas/Dropbox/adolescent_networks/data/workspace_1.RData")
data_long_complete <- na.omit(data_long)


# Subsetting
labels <- c("tv", "socialmedia", "familyeat", "friends", "lifesatisfaction", "alcohol", "smoking", "stay_late", "age")
data_short <- data_long_complete[, labels]

```


## Fitting a Network Model (Gaussian Graphical Model)


```{r, message=FALSE}
library(mgm)
mgm_obj <- mgm(data = data_short, 
               type = rep("g", 9), 
               level = rep(1, 9), 
               lambdaSel = "EBIC", 
               pbar=FALSE)
```


Visualizing:

```{r, fig.align="center", fig.width=6, fig.height=6}

library(qgraph)
qgraph(mgm_obj$pairwise$wadj, 
       edge.color = mgm_obj$pairwise$edgecolor, 
       edge.labels = TRUE,
       layout = "circle", 
       labels = labels)
```


## Fitting a Moderated Network Model

Fit moderated network model:

```{r, messages=FALSE}
mgm_obj_wM <- mgm(data = data_short, 
                  type = c(rep("g", 9)), 
                  level = c(rep(1, 9)), 
                  moderators = 9,
                  lambdaSel = "EBIC", 
                  pbar = FALSE)
```

Are there any moderation effects?

```{r}
mgm_obj_wM$interactions$indicator
```

Visualize as factor graph:


```{r}
FactorGraph(mgm_obj_wM, PairwiseAsEdge = TRUE, edge.labels=TRUE)
```



## Condition on the Moderator age


We again condition. However, in contrast to categorical moderators, we do not condition on group, but we can condition on any value for age. First, we look at which values we actually have data for age. Here we look at the z-transformed versions of age, because this is what is used in mgm internally (to ensure that the reguarlization is independent of the variance of variables):

```{r, fig.align="center", fig.width=4, fig.height=4}

hist(scale(data_long_complete$age), main = "age", xlab="")

```

The values -1.5, 0, 1.5 reasonably cover the range and we therefore choose those for now:


```{r}
mgm_obj_wM_age_0 <- condition(object = mgm_obj_wM, 
                              values = list("9"=-1.5))

mgm_obj_wM_age_1 <- condition(object = mgm_obj_wM, 
                              values = list("9"=0))

mgm_obj_wM_age_2 <- condition(object = mgm_obj_wM, 
                              values = list("9"=1.5))

l_mgm_obj <- list(mgm_obj_wM_age_0, mgm_obj_wM_age_1, mgm_obj_wM_age_2)
values = c(-1.5, 0, 1.5)

```


Visualize:

```{r, fig.align="center", fig.width=15, fig.height=5}

par(mfrow=c(1,3))

for(i in 1:3) qgraph(l_mgm_obj[[i]]$pairwise$wadj, 
                     edge.color = l_mgm_obj[[i]]$pairwise$edgecolor, 
                     edge.labels = TRUE,
                     layout = "circle", 
                     labels = labels_wM, title = "Age = -1.5", maximum = .3)

```
















