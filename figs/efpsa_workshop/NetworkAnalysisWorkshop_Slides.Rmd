---
title: "Network Analysis Workshop"
author: "jonashaslbeck@gmail.com"
date: "May 4, 2016"
output: ioslides_presentation
---


## Overview

0. Installing Software & Packages
1. Why Networks?
2. What are Networks?
3. Constructing a Network
4. Correlation Networks
5. Conditional Independence Networks
6. Time Series

## Installing Software & Packages

- Install R: http://cran.freestatistics.org
- Install RStudio: https://www.rstudio.com/products/rstudio/download/
- Install packages:

```{r, eval=FALSE}
install.packages('qgraph') # Network visualization
install.packages('huge') # Gaussian Graphical Models
install.packages('mgm') # Mixed Graphical Models & mixed VAR
```

- Load packages:

```{r, eval=TRUE}
library(qgraph)
library(huge)
library(mgm)
```


## Download R - file with code of all exercises

Download the R-file with all exercises here:

<http://jmbh.github.io>

(Here you can also find the slides)

## What are Networks?

```{r, out.width = 450, fig.retina = NULL, echo=FALSE, fig.align='center'}

knitr::include_graphics("Example_Graph.pdf")

```

<center>  Nodes = Entities; Edges = Relations </center> 


## Computer Network

```{r, out.width = 550, fig.retina = NULL, echo=FALSE, fig.align='center'}

knitr::include_graphics("computernetwork.jpg")

```


## Network of Corporate Control

```{r, out.width = 750, fig.retina = NULL, echo=FALSE, fig.align='center'}

knitr::include_graphics("corpcontrol.png")

```


<center>  Vitali et al. 2011 </center> 

## Facebook Friendship network

```{r, out.width = 500, fig.retina = NULL, echo=FALSE, fig.align='center'}
knitr::include_graphics("facebook-friend-graph.png")
```


## Psychopathological Classification Network

```{r, out.width = 650, fig.retina = NULL, echo=FALSE, fig.align='center'}
knitr::include_graphics("DSM_graph.JPG")
```

<center>  (Borsboom et al., 2011) </center> 

## Psychopathological Symptom Network

```{r, out.width = 650, fig.retina = NULL, echo=FALSE, fig.align='center'}
knitr::include_graphics("BDI_cor_graph.pdf")
```



## Different types of Networks

```{r, out.width = 450, fig.retina = NULL, echo=FALSE, fig.align='center'}
knitr::include_graphics("Examples_DifferentGraphs.pdf")
```


## Let's construct a Network!

```{r}

AdjacencyMatrix <- matrix(0,4,4)
AdjacencyMatrix[1,2] <- AdjacencyMatrix[2,1] <- 1
AdjacencyMatrix[2,3] <- AdjacencyMatrix[3,2] <- 1
AdjacencyMatrix[2,4] <- AdjacencyMatrix[4,2] <- 1

AdjacencyMatrix

```

## Our first network visualization

```{r}

qgraph(AdjacencyMatrix)

```


## Generate a random network

```{r}
p <- 20
AdjMatrix <- matrix(0,p,p)
set.seed(22)
AdjMatrix[upper.tri(AdjMatrix)] <- sample(0:1,(p*(p-1))/2, 
                                         prob=c(.9,.1),replace=TRUE)
AdjMatrix <- AdjMatrix + t(AdjMatrix)

AdjMatrix[1:5,1:5]

```


## Visualize the Random Network

```{r}

qgraph(AdjMatrix)

```


## Correlation Networks

```{r, out.width = 700, fig.retina = NULL, echo=FALSE, fig.align='center'}

knitr::include_graphics("Pic_CorrelationNetwork.png")

```



## Correlation Networks - Load data

Load Depression data from web:

```{r}

download.file(url='http://jmbh.github.io/figs/efpsa_workshop/BDIdata.RDS',
              destfile = 'BDIdata.RDS')

BDI_data <- readRDS('BDIdata.RDS')

```

3640 Responses to Beck's Depression Inventory (BDI)


## Correlation Networks - look at data

Let's have a first look at the data:

```{r}

# data
BDI_data$data[1:3,1:5]

#labels
BDI_data$vnames[1:5]

```



## Correlation Networks - Compute Correlation Matrix

```{r}
CorMatrix <- cor(BDI_data$data)

round(CorMatrix[1:4, 1:4],2)

```


## Correlation Networks - Visualize Correlation Matrix

```{r}

qgraph(CorMatrix, nodeNames=BDI_data$vnames, legend.cex = .3, vsize=4)

```


## Correlation Networks - Visualize Correlation Matrix

```{r}

qgraph(CorMatrix, nodeNames=BDI_data$vnames, 
       legend.cex = .3, layout='spring', vsize=3)

```


## The Problem with spurious correlations

```{r, out.width = 700, fig.retina = NULL, echo=FALSE, fig.align='center'}

knitr::include_graphics("Spurious_Cor_illustration.pdf")

```


## Conditional Independence Networks

```{r, out.width = 700, fig.retina = NULL, echo=FALSE, fig.align='center'}

knitr::include_graphics("ConditionalDependenceNetworks.png")

```


## Conditional Independence Networks - Estimation

```{r}

fit <- mgmfit(BDI_data$data, rep('g', 28), rep(1, 28), pbar=FALSE)

round(fit$wadj[1:4, 1:4],2)

```


## Conditional Independence Networks - Visualization

```{r}

qgraph(fit$wadj, nodeNames=BDI_data$vnames, 
       legend.cex = .3, layout='spring', vsize=3)

```


## Conditional Independence Networks from Mixed Data

```{r, out.width = 700, fig.retina = NULL, echo=FALSE, fig.align='center'}

knitr::include_graphics("whymixedMRFs.pdf")

```

## Mixed Data: Autism Dataset

Load data from the web:

```{r}
download.file(url='http://jmbh.github.io/figs/efpsa_workshop/autism_datalist.RDS',
              destfile = 'autism_datalist.RDS')
Autism_data <- readRDS('autism_datalist.RDS')


```


## Mixed Autism Dataset - Look at data

```{r}

dim(Autism_data$data)

```


## Mixed Autism Dataset - Estimation

```{r}

fit2 <- mgmfit(Autism_data$data[1:300,], Autism_data$type, Autism_data$lev, d=1, pbar=FALSE)

round(fit2$wadj[1:4, 1:4],2)


```


## Mixed Autism Dataset - Visualization

```{r}
qgraph(fit2$wadj, nodeNames=Autism_data$colnames, 
       layout='spring', edge.color=fit2$edgecolor, 
       legend.cex=.3, vsize=3)

```


## Mixed Autism Dataset - Visualization II

```{r}

groups_typeV <- list("Gaussian"=which(Autism_data$type=='g'), 
                     "Poisson"=which(Autism_data$type=='p'),
                     "Categorical"=which(Autism_data$type=='c'))

# pick some nice colors
group_colV <- c("#72CF53", "#53B0CF", "#ED3939")


qgraph(fit2$wadj, nodeNames=Autism_data$colnames, 
       layout='spring', edge.color=fit2$edgecolor, 
       legend.cex=.3, vsize=3, color=group_colV, 
       groups=groups_typeV)

```


## Mixed Autism Dataset - Visualization II

```{r, out.width = 700, fig.retina = NULL, echo=FALSE, fig.align='center'}

knitr::include_graphics("JSS_autism_figure_weighted_Eiko_groupType.pdf")

```




## What have we learned?

- Set up a (random) Nework in R
- Compute and Visualize Correlation Network
- Estimate and Visualize Conditional Independence Networks

But there is much more ...

- Closer Examination of Categorical Data
- Directed Graphs
- Time Series Models
- ...

Contact:

jonashaslbeck@gmail.com / http://jmbh.github.io (Slides!)


## Suggested Reading 

- arRt of personality research
- lauras Var paper
- my network paper




